{% extends 'layout.html' %} 

{% block title %}  
Listing {{ listing.id }} 
{% endblock %}  


{% block body %} 
{% load static %}
{% load crispy_forms_tags %}
<div class="container py-2">
    {% if is_watching %} 
    <a href="{% url 'auction:toggle_watch' listing.id %}">
        <button class="btn btn-secondary">Remove from Watchlist</button>
    </a>
    {% else %} 
    <a href="{% url 'auction:toggle_watch' listing.id %}">
        <button class="btn btn-secondary">Add to Watchlist</button>
    </a>
    {% endif %}
    <hr>
    {% if listing.image %} 
    <div id="image">
    <img src="{{ listing.image.url }}" class="card-img-top img-fluid">
    </div>
    {% else %}  
    <img src="{% static 'Auction/no_image.jpg' %}" class="card-img-top img-fluid">
    {% endif %}
    <br/>
    <h2>{{ listing.title }}</h2>
    <h5>
    Starting Price: {{ listing.starting_price }}
    </h5>
    <h6>
    {{ listing.description }}
    </h6><br/><br/>
    Created at: {{ listing.created_at }}<br/>
    Last Update: {{ listing.updated_at }}<br/>
    <br/>
    {% if request.user.is_authenticated and request.user == listing.user %}
    <a class="btn btn-primary" href="{% url 'auction:edit_listing' listing.id %}">Edit</a>
    <a class='btn btn-primary' href="{% url 'auction:delete_listing' listing.id %}">Delete</a>
    {% endif %}
    <br/><br/><br/>
    <h4>Comments</h4>
    <hr>
    {% for comment in listing.comments.all %} 
    <b><h5>{{ comment.user }}:</h5></b>
    {{ comment.content }}<br/><br/>
    Posted at : {{ comment.created_at }}<br/><br/>
    {% if request.user == comment.user and request.user.is_authenticated %}
    <a class='btn btn-secondary' href="{% url 'auction:delete_comment' listing.id comment.id %}">Delete</a>
    {% endif %}
    <hr>
    {% empty %}
    No comments. Be the first one to leave a comment!
    <hr>
    {% endfor %} 
    {% if request.user.is_authenticated %} 
    <h4>Leave a Comment:</h4>
    <form action="{% url 'auction:comment' listing.id %}" method="post">
        {% csrf_token %} 
        {{ comment_form|crispy }}
        <input type="submit" value="Post" class='btn btn-secondary'/>
    </form>
    {% else %} 
    <h6>If you want to leave a comment, <a href='{% url "auction:login" %}'>Login</a> first.</h6>
    {% endif %}
</div>
{% endblock %}